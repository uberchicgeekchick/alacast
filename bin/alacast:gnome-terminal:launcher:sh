#!/bin/sh --noprofile

alacasts_path=`dirname "${0}"`;
cd "${alacasts_path}";
alacasts_path=`pwd`;
alacasts_exec="${alacasts_path}/alacast.php";
if test ! -x "${alacasts_exec}"; then
	printf "Unable to find alacast.php or its not exectuable.\n\tAttempting to run: %s" "${alacasts_exec}";
	exit -1;
fi
if test -n "$ALACAST_OPTIONS"; then export ALACAST_OPTIONS='--logging --titles-append-pubdate --strip-characters=#;! --update=detailed --interactive'; fi


alacasts_config="";
if test -e "${HOME}/.alacast/alacast.ini"; then
	alacasts_config="${HOME}/.alacast/alacast.ini";
elif test -e "${HOME}/.alacast/profiles/${USER}/alacast.ini"; then
	alacasts_config="${HOME}/.alacast/profiles/${USER}/alacast.ini";
elif test -e "${alacasts_path}/../data/${USER}/default/alacast.ini"; then
	alacasts_config="${alacasts_path}/../data/profiles/${USER}/alacast.ini";
elif test -e "${alacasts_path}/../data/profiles/default/alacast.ini"; then
	alacasts_config="${alacasts_path}/../data/profiles/default/alacast.ini";
fi
if test -e "${alacasts_config}"; then
	alacasts_resolution=`cat "${alacasts_config}" | grep 'resolutions.gnome-terminal' | sed 's/.*resolutions\.gnome\-terminal="\([^"]\+\)";/\1/'`;
	alacasts_options=`cat "${alacasts_config}" | grep 'options.cli' | sed 's/.*options\.cli="\([^"]\+\)";/\1/'`;
else
	alacasts_resolution="114x40"
	alacasts_options="--with-defaults";
fi

/usr/bin/gnome-terminal							\
	--geometry="${alacasts_resolution}"				\
	--hide-menubar							\
	--role='Media:Alacast'						\
	--title="alacast:php"						\
	--working-directory="${alacasts_path}"				\
	--command="${alacasts_exec} ${alacasts_options} ${argv}" &
